<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØªÙƒÙ„ÙØ© - 3D Isometric Fixer</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Control Panel -->
    <div class="control-panel">
        <h2>ğŸ› ï¸ Ù…Ø­Ø±Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h2>

        <div class="file-upload">
            <label for="imageInput">ğŸ“‚ Ø±ÙØ¹ ØµÙˆØ±Ø© (Background)</label>
            <input type="file" id="imageInput" accept="image/*">
        </div>

        <div class="input-group">
            <label>1. Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Top Center)</label>
            <input type="text" id="input-1" value="Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø±ÙŠØ§Ø¶" oninput="updateText(1)">
        </div>

        <div class="input-group">
            <label>2. Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ (Sub-heading)</label>
            <input type="text" id="input-2" value="Ø®Ø¯Ù…Ø§Øª ØªÙƒÙ„ÙØ©" oninput="updateText(2)">
        </div>

        <div class="input-group">
            <label>3. ÙÙ‚Ø§Ø¹Ø© ÙŠÙ…ÙŠÙ† 1 (Green)</label>
            <input type="text" id="input-3" value="ÙˆÙØ± 70% Ù…Ù† ÙˆÙ‚ØªÙƒ" oninput="updateText(3)">
        </div>

        <div class="input-group">
            <label>4. ÙÙ‚Ø§Ø¹Ø© ÙŠÙ…ÙŠÙ† 2 (Blue)</label>
            <input type="text" id="input-4" value="Ø®Ø¯Ù…Ø§ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©" oninput="updateText(4)">
        </div>

        <div class="input-group">
            <label>5. ÙÙ‚Ø§Ø¹Ø© ÙŠØ³Ø§Ø± 1 (Red)</label>
            <input type="text" id="input-5" value="Ø­ÙˆÙ„ Ø£Ø¹Ù…Ø§Ù„Ùƒ Ø¥Ù„Ù‰ ØªÙƒÙ„ÙØ©" oninput="updateText(5)">
        </div>

        <div class="input-group">
            <label>6. ÙÙ‚Ø§Ø¹Ø© ÙŠØ³Ø§Ø± 2 (Orange)</label>
            <input type="text" id="input-6" value="AI ÙŠØ±ÙØ¹ Ù…Ù†ØªØ¬Ø§ØªÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§" oninput="updateText(6)">
        </div>

        <div class="input-group">
            <label>7. Ø²Ø± Ø§Ù„Ø¯Ø¹ÙˆØ© (Bottom CTA)</label>
            <input type="text" id="input-7" value="Ø§Ù†Ø¶Ù… Ù„Ø¢Ù„Ø§Ù Ø§Ù„ØªØ¬Ø§Ø± ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶" oninput="updateText(7)">
        </div>

        <div class="actions">
            <button class="btn btn-save" onclick="saveImage()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
        </div>

        <div style="margin-top: 20px; font-size: 0.8rem; color: #64748b; text-align: center;">
            * Ø§Ø³ØªØ®Ø¯Ù… html2canvas Ù„Ù„Ø­ÙØ¸ (Ù…Ø¯Ù…Ø¬)
        </div>
    </div>

    <!-- Canvas Area -->
    <div class="canvas-area">
        <div class="ad-container" id="adContainer">
            <!-- Banners -->
            <div id="banner-1" class="banner">Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø±ÙŠØ§Ø¶</div>
            <div id="banner-2" class="banner">Ø®Ø¯Ù…Ø§Øª ØªÙƒÙ„ÙØ©</div>
            <div id="banner-3" class="banner">ÙˆÙØ± 70% Ù…Ù† ÙˆÙ‚ØªÙƒ</div>
            <div id="banner-4" class="banner">Ø®Ø¯Ù…Ø§ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</div>
            <div id="banner-5" class="banner">Ø­ÙˆÙ„ Ø£Ø¹Ù…Ø§Ù„Ùƒ Ø¥Ù„Ù‰ ØªÙƒÙ„ÙØ©</div>
            <div id="banner-6" class="banner">AI ÙŠØ±ÙØ¹ Ù…Ù†ØªØ¬Ø§ØªÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</div>
            <div id="banner-7" class="banner">Ø§Ù†Ø¶Ù… Ù„Ø¢Ù„Ø§Ù Ø§Ù„ØªØ¬Ø§Ø± ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</div>
        </div>
    </div>

    <!-- html2canvas Library -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        // Update Text Function
        function updateText(id) {
            const input = document.getElementById(`input-${id}`);
            const banner = document.getElementById(`banner-${id}`);
            banner.textContent = input.value;
        }

        // Handle Image Upload
        const imageInput = document.getElementById('imageInput');
        const adContainer = document.getElementById('adContainer');

        imageInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    adContainer.style.backgroundImage = `url('${event.target.result}')`;
                }
                reader.readAsDataURL(file);
            }
        });

        // Save Image Function
        function saveImage() {
            // Temporarily remove scale to capture full resolution
            const originalTransform = adContainer.style.transform;
            adContainer.style.transform = 'scale(1)';

            // We need to append it to body temporarily if it's hidden or scaled weirdly, 
            // but here it's visible. However, capturing a scaled element might be tricky.
            // Best approach: Clone it, position it off-screen at full size, capture, then remove.

            html2canvas(adContainer, {
                scale: 1, // Capture at 1:1 of the element's size (1080x1080)
                useCORS: true,
                backgroundColor: null
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'taklifa-ad-fixed.png';
                link.href = canvas.toDataURL('image/png');
                link.click();

                // Restore scale
                adContainer.style.transform = originalTransform;
            });
        }

        // Auto-load ad_image.jpg if exists
        window.onload = function () {
            const img = new Image();
            img.onload = function () {
                adContainer.style.backgroundImage = `url('ad_image.jpg')`;
            };
            img.onerror = function () {
                console.log("No default ad_image.jpg found.");
            };
            img.src = 'ad_image.jpg';

            // Adjust scale on resize
            window.addEventListener('resize', adjustScale);
            adjustScale();
        };

        function adjustScale() {
            const area = document.querySelector('.canvas-area');
            const container = document.getElementById('adContainer');
            const padding = 40;

            const availableWidth = area.clientWidth - padding;
            const availableHeight = area.clientHeight - padding;

            const scale = Math.min(
                availableWidth / 1080,
                availableHeight / 1080
            );

            container.style.transform = `scale(${scale})`;
        }
    </script>
</body>

</html>